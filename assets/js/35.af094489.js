(window.webpackJsonp=window.webpackJsonp||[]).push([[35],{189:function(e,t,a){"use strict";a.r(t);var s=a(0),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"adding-and-removing-ibft-validators"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-and-removing-ibft-validators","aria-hidden":"true"}},[e._v("↳")]),e._v(" Adding and removing IBFT validators")]),e._v(" "),a("p",[e._v("Over the lifetime of an IBFT network, validators will need to be added and removed as authorities change.\nHere we will showcase adding a new validator to an IBFT network, as well as removing an existing one.")]),e._v(" "),a("h2",{attrs:{id:"adding-a-node-to-the-validator-set"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#adding-a-node-to-the-validator-set","aria-hidden":"true"}},[e._v("↳")]),e._v(" Adding a node to the validator set")]),e._v(" "),a("p",[e._v("Adding a node to the IBFT validator set is relatively easy once a node is part of the network.\nIt does not matter whether the node is already online or not, as the process to add the new node as a validator only\nneeds the "),a("em",[e._v("existing")]),e._v(" validators.")]),e._v(" "),a("p",[e._v("!!! warning\nIf you are adding multiple validators before they are brought online, make sure you don't go over the BFT limit and cause the chain to stop progressing.")]),e._v(" "),a("p",[e._v("Adding a new validator requires that a majority of existing validators propose the new node to be added. This is\nachieved by calling the "),a("code",[e._v("propose")]),e._v(" RPC method with the value "),a("code",[e._v("true")]),e._v(" and replacing the address to your required one:")]),e._v(" "),a("pre",[a("code",[e._v('```bash\n$ geth attach /qdata/dd/geth.ipc\n\n> istanbul.propose("0xb131288f355bc27090e542ae0be213c20350b767", true);\nnull\n```\n')])]),e._v(" "),a("p",[e._v("This indicates that the current node wishes to add address "),a("code",[e._v("0xb131288f355bc27090e542ae0be213c20350b767")]),e._v(" as a new\nvalidator.")]),e._v(" "),a("h3",{attrs:{id:"example"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example","aria-hidden":"true"}},[e._v("↳")]),e._v(" Example")]),e._v(" "),a("p",[e._v("You can find the resources required to run the examples in the\n"),a("a",{attrs:{href:"https://github.com/smilofoundation/Smilo-examples/tree/master/examples/ibft_validator_set_changes",target:"_blank",rel:"noopener noreferrer"}},[e._v("Smilo-examples"),a("OutboundLink")],1),e._v("\nrepository.")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("The examples use "),a("code",[e._v("docker-compose")]),e._v(" for the container definitions. If you are following along by copying the commands\ndescribed, then it is important to set the project name for Docker Compose, or to remember to change the prefix for\nyour directory. See "),a("a",{attrs:{href:"https://docs.docker.com/compose/reference/envvars/#compose_project_name",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker documentation"),a("OutboundLink")],1),e._v("\nfor more details.")]),e._v(" "),a("p",[e._v("To set the project name, run the following:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("COMPOSE_PROJECT_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("addnode\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Bring up the network, which contains 7 nodes, of which 6 are validators.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ docker-compose -f ibft-6-validators.yml up\n")])])]),a("p",[e._v("We will be adding the 7th node as a validator. You may notice in the logs of node 7 messages along the lines of\n"),a("code",[e._v("node7_1 | WARN [01-20|10:37:16.034] Block sealing failed err=unauthorized")]),e._v(". This is because\nthe node was started up with minting enabled, but doesn't have the authority to create blocks, and so throws this\nerror.")])]),e._v(" "),a("li",[a("p",[e._v("Now we need to propose node 7 as a new proposer from the existing nodes.")]),e._v(" "),a("p",[e._v("!!! note\nRemember, you could do this stage before starting node 7 in your network")]),e._v(" "),a("p",[e._v("We need a majority of existing validators to propose the new node before the changes will take effect.")]),e._v(" "),a("p",[e._v("Lets start with node 1 and see what happens:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Propose node 7 from node 1")]),e._v("\n$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node1_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.propose(\"0xb131288f355bc27090e542ae0be213c20350b767\", true);'")]),e._v(" attach /qdata/dd/geth.ipc\nnull\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Wait about 5 seconds, and then run:")]),e._v("\n$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node1_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.getSnapshot();'")]),e._v(" attach /qdata/dd/geth.ipc\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  epoch: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("30000")]),e._v(",\n  hash: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xf814863d809ce3a683ee0a2197b15a8152d2696fc9c4e47cd82d0bd5cdaa3e45"')]),e._v(",\n  number: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("269")]),e._v(",\n  policy: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(",\n  tally: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    0xb131288f355bc27090e542ae0be213c20350b767: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      authorize: true,\n      votes: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(",\n  validators: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x6571d97f340c8495b661a823f2c2145ca47d63c2"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x8157d4437104e3b8df4451a85f7b2438ef6699ff"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xb912de287f9b047b4228436e94b5b78e3ee16171"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xd8dba507e85f116b1f7e231ca8525fc9008a6966"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xe36cbeb565b061217930767886474e3cde903ac5"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xf512a992f3fb749857d758ffda1330e590fa915e"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(",\n  votes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      address: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xb131288f355bc27090e542ae0be213c20350b767"')]),e._v(",\n      authorize: true,\n      block: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("268")]),e._v(",\n      validator: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xd8dba507e85f116b1f7e231ca8525fc9008a6966"')]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("Let's break this down.\nFirstly, we proposed the address "),a("code",[e._v("0xb131288f355bc27090e542ae0be213c20350b767")]),e._v(" to be added; that is what the "),a("code",[e._v("true")]),e._v("\nparameter is for. If we had set it to "),a("code",[e._v("false")]),e._v(", that means we want to remove an existing validator with that address.")]),e._v(" "),a("p",[e._v("Secondly, we fetched the current snapshot, which gives us an insight into the current running state of the voting.\nWe can see that the new address has 1 vote under the "),a("code",[e._v("tally")]),e._v(" section, and that one vote is described under the\n"),a("code",[e._v("votes")]),e._v(" section. So we know our vote was registered!")])]),e._v(" "),a("li",[a("p",[e._v("Let's run this from node 2 and see similar results:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node2_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.propose(\"0xb131288f355bc27090e542ae0be213c20350b767\", true);'")]),e._v(" attach /qdata/dd/geth.ipc\nnull\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Again, you may have to wait 5 - 10 seconds for the snapshot to show the vote")]),e._v("\n$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node2_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.getSnapshot();'")]),e._v(" attach /qdata/dd/geth.ipc\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  epoch: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("30000")]),e._v(",\n  hash: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x93efcd458f3b875902a4532bb77d5e7ebb701791ea95486ecd58baf682312d74"')]),e._v(",\n  number: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("391")]),e._v(",\n  policy: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(",\n  tally: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    0xb131288f355bc27090e542ae0be213c20350b767: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      authorize: true,\n      votes: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("2")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(",\n  validators: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x6571d97f340c8495b661a823f2c2145ca47d63c2"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x8157d4437104e3b8df4451a85f7b2438ef6699ff"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xb912de287f9b047b4228436e94b5b78e3ee16171"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xd8dba507e85f116b1f7e231ca8525fc9008a6966"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xe36cbeb565b061217930767886474e3cde903ac5"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xf512a992f3fb749857d758ffda1330e590fa915e"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(",\n  votes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      address: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xb131288f355bc27090e542ae0be213c20350b767"')]),e._v(",\n      authorize: true,\n      block: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("388")]),e._v(",\n      validator: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xd8dba507e85f116b1f7e231ca8525fc9008a6966"')]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(", "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      address: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xb131288f355bc27090e542ae0be213c20350b767"')]),e._v(",\n      authorize: true,\n      block: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("390")]),e._v(",\n      validator: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x6571d97f340c8495b661a823f2c2145ca47d63c2"')]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("True to form, we have the second vote registered!")])]),e._v(" "),a("li",[a("p",[e._v("Ok, let's finally vote on nodes 3 and 4.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node3_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.propose(\"0xb131288f355bc27090e542ae0be213c20350b767\", true);'")]),e._v(" attach /qdata/dd/geth.ipc\nnull\n\n$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node4_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.propose(\"0xb131288f355bc27090e542ae0be213c20350b767\", true);'")]),e._v(" attach /qdata/dd/geth.ipc\nnull\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Now we have a majority of votes, let's check the snapshot again:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node1_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.getSnapshot();'")]),e._v(" attach /qdata/dd/geth.ipc\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  epoch: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("30000")]),e._v(",\n  hash: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xd4234184538297f71f5b7024a2e11f51f06b4f569ebd9e3644abd391b8c66101"')]),e._v(",\n  number: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("656")]),e._v(",\n  policy: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(",\n  tally: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(",\n  validators: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x6571d97f340c8495b661a823f2c2145ca47d63c2"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x8157d4437104e3b8df4451a85f7b2438ef6699ff"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xb131288f355bc27090e542ae0be213c20350b767"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xb912de287f9b047b4228436e94b5b78e3ee16171"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xd8dba507e85f116b1f7e231ca8525fc9008a6966"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xe36cbeb565b061217930767886474e3cde903ac5"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xf512a992f3fb749857d758ffda1330e590fa915e"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(",\n  votes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("We can see that the votes have now been wiped clean, ready for a new round. Additionally, the address we were adding,\n"),a("code",[e._v("0xb131288f355bc27090e542ae0be213c20350b767")]),e._v(" now exists within the "),a("code",[e._v("validators")]),e._v(" list!\nLastly, the "),a("code",[e._v("unauthorized")]),e._v(" messages that node 7 was giving before has stopped, as it now has the authority to mint\nblocks.")])])]),e._v(" "),a("h2",{attrs:{id:"removing-a-node-from-the-validator-set"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#removing-a-node-from-the-validator-set","aria-hidden":"true"}},[e._v("↳")]),e._v(" Removing a node from the validator set")]),e._v(" "),a("p",[e._v("Removing a validator is very similar to adding a node, but this time we want to propose nodes with the value "),a("code",[e._v("false")]),e._v(",\nto indicate we are deauthorising them. It does not matter whether the node is still online or not, as it doesn't\nrequire any input from the node being removed.")]),e._v(" "),a("p",[e._v("!!! warning\nBe aware when removing nodes that cross the BFT boundary, e.g. going from 10 validators to 9, as this may impact the chains ability to progress if other nodes are offline")]),e._v(" "),a("p",[e._v("Removing a new validator requires that a majority of existing validators propose the new node to be removed. This is\nachieved by calling the "),a("code",[e._v("propose")]),e._v(" RPC method with the value "),a("code",[e._v("false")]),e._v(" and replacing the address to your required one:")]),e._v(" "),a("pre",[a("code",[e._v('```bash\n$ geth attach /qdata/dd/geth.ipc\n\n> istanbul.propose("0xb131288f355bc27090e542ae0be213c20350b767", false);\nnull\n```\n')])]),e._v(" "),a("h3",{attrs:{id:"example-2"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#example-2","aria-hidden":"true"}},[e._v("↳")]),e._v(" Example")]),e._v(" "),a("p",[e._v("You can find the resources required to run the examples in the\n"),a("a",{attrs:{href:"https://github.com/smilofoundation/Smilo-examples/tree/master/examples/ibft_validator_set_changes",target:"_blank",rel:"noopener noreferrer"}},[e._v("Smilo-examples"),a("OutboundLink")],1),e._v("\nrepository.")]),e._v(" "),a("ol",[a("li",[a("p",[e._v("The examples use "),a("code",[e._v("docker-compose")]),e._v(" for the container definitions. If you are following along by copying the commands\ndescribed, then it is important to set the project name for Docker Compose, or to remember to change the prefix for\nyour directory. See "),a("a",{attrs:{href:"https://docs.docker.com/compose/reference/envvars/#compose_project_name",target:"_blank",rel:"noopener noreferrer"}},[e._v("Docker documentation"),a("OutboundLink")],1),e._v("\nfor more details.")]),e._v(" "),a("p",[e._v("To set the project name, run the following:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("COMPOSE_PROJECT_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("addnode\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Bring up the network, which contains 7 nodes, of which 6 are validators.")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Set the environment variable for docker-compose")]),e._v("\n$ "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("export")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token assign-left variable"}},[e._v("COMPOSE_PROJECT_NAME")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v("addnode\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Start the 7 node network, of which 6 are validators")]),e._v("\n$ docker-compose -f ibft-6-validators.yml up\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Now we need to propose node 6 as the node to remove.")]),e._v(" "),a("p",[e._v("!!! note\nWe need a majority of existing validators to propose the new node before the changes will take effect.")]),e._v(" "),a("p",[e._v("Lets start with node 1 and see what happens:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Propose node 7 from node 1")]),e._v("\n$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node1_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.propose(\"0x8157d4437104e3b8df4451a85f7b2438ef6699ff\", false);'")]),e._v(" attach /qdata/dd/geth.ipc\nnull\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("# Wait about 5 seconds, and then run:")]),e._v("\n$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node1_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.getSnapshot();'")]),e._v(" attach /qdata/dd/geth.ipc\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  epoch: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("30000")]),e._v(",\n  hash: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xba9f9b72cad90ae8aee39f352b45f21d5ed5535b4479743e3f39b231fd717792"')]),e._v(",\n  number: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("140")]),e._v(",\n  policy: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(",\n  tally: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    0x8157d4437104e3b8df4451a85f7b2438ef6699ff: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      authorize: false,\n      votes: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(",\n  validators: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x6571d97f340c8495b661a823f2c2145ca47d63c2"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x8157d4437104e3b8df4451a85f7b2438ef6699ff"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xb912de287f9b047b4228436e94b5b78e3ee16171"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xd8dba507e85f116b1f7e231ca8525fc9008a6966"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xe36cbeb565b061217930767886474e3cde903ac5"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xf512a992f3fb749857d758ffda1330e590fa915e"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(",\n  votes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      address: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x8157d4437104e3b8df4451a85f7b2438ef6699ff"')]),e._v(",\n      authorize: false,\n      block: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("136")]),e._v(",\n      validator: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xd8dba507e85f116b1f7e231ca8525fc9008a6966"')]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("Let's break this down.\nFirstly, we proposed the address "),a("code",[e._v("0x8157d4437104e3b8df4451a85f7b2438ef6699ff")]),e._v(" to be removed; that is what the\n"),a("code",[e._v("false")]),e._v(" parameter is for.")]),e._v(" "),a("p",[e._v("Secondly, we fetched the current snapshot, which gives us an insight into the current running state of the voting.\nWe can see that the proposed address has 1 vote under the "),a("code",[e._v("tally")]),e._v(" section, and that one vote is described under the\n"),a("code",[e._v("votes")]),e._v(" section. Here, the "),a("code",[e._v("authorize")]),e._v(" section is set to "),a("code",[e._v("false")]),e._v(", which is inline with our proposal to "),a("em",[e._v("remove")]),e._v(" the\nvalidator.")])]),e._v(" "),a("li",[a("p",[e._v("We need to get a majority, so let's run the proposal on 3 more nodes:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node2_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.propose(\"0x8157d4437104e3b8df4451a85f7b2438ef6699ff\", false);'")]),e._v(" attach /qdata/dd/geth.ipc\nnull\n\n$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node3_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.propose(\"0x8157d4437104e3b8df4451a85f7b2438ef6699ff\", false);'")]),e._v(" attach /qdata/dd/geth.ipc\nnull\n\n$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node4_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.propose(\"0x8157d4437104e3b8df4451a85f7b2438ef6699ff\", false);'")]),e._v(" attach /qdata/dd/geth.ipc\nnull\n")])])])]),e._v(" "),a("li",[a("p",[e._v("Let's check the snapshot now all the required votes are in:")]),e._v(" "),a("div",{staticClass:"language-bash extra-class"},[a("pre",{pre:!0,attrs:{class:"language-bash"}},[a("code",[e._v("$ docker "),a("span",{pre:!0,attrs:{class:"token builtin class-name"}},[e._v("exec")]),e._v(" -it addnode_node1_1 geth --exec "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'istanbul.getSnapshot();'")]),e._v(" attach /qdata/dd/geth.ipc\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  epoch: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("30000")]),e._v(",\n  hash: "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x25815a32b086926875ea2c44686e4b20effabc731b2b121ebf0e0f395101eea5"')]),e._v(",\n  number: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("470")]),e._v(",\n  policy: "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),e._v(",\n  tally: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(",\n  validators: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0x6571d97f340c8495b661a823f2c2145ca47d63c2"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xb912de287f9b047b4228436e94b5b78e3ee16171"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xd8dba507e85f116b1f7e231ca8525fc9008a6966"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xe36cbeb565b061217930767886474e3cde903ac5"')]),e._v(", "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"0xf512a992f3fb749857d758ffda1330e590fa915e"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v(",\n  votes: "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])])]),a("p",[e._v("The validator has been removed from the "),a("code",[e._v("validators")]),e._v(" list, and we are left with the other 5 still present. You will\nalso see in the logs of node 6 a message like\n"),a("code",[e._v("node6_1 | WARN [01-20|11:35:52.044] Block sealing failed err=unauthorized")]),e._v(". This is because it is still minting\nblocks, but realises it does not have the authority to push them to any of the other nodes on the network (you will\nalso see this message for node 7, which was never authorised but still set up to mine).")])])]),e._v(" "),a("h2",{attrs:{id:"see-also"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#see-also","aria-hidden":"true"}},[e._v("↳")]),e._v(" See also")]),e._v(" "),a("ul",[a("li",[a("a",{attrs:{href:"/How-To-Guides/adding_nodes"}},[e._v("Adding a new node to the network")])])])])}),[],!1,null,null,null);t.default=n.exports}}]);