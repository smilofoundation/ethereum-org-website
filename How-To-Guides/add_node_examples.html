<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Node addition examples | Smilo</title>
    <meta name="description" content="">
    <meta/ name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,maximum-scale=1"></meta/>
  <link rel="icon" type="image/png" href="/favicon.png">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="smilo.foundation">
  <meta property="og:url" content="https://smilo.foundation">
  <meta property="og:image" content="https://smilo.foundation/og-image.png">
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:site" content="@smiloplatform">
  <meta property="twitter:creator" content="@smiloplatform">
  <meta property="twitter:image" content="https://smilo.foundation/og-image-twitter.png">
    <link rel="preload" href="/assets/css/0.styles.77284882.css" as="style"><link rel="preload" href="/assets/js/app.1c5a03b7.js" as="script"><link rel="preload" href="/assets/js/3.030594d3.js" as="script"><link rel="preload" href="/assets/js/36.fd9805c3.js" as="script"><link rel="prefetch" href="/assets/js/10.6e3e9273.js"><link rel="prefetch" href="/assets/js/100.54f82e92.js"><link rel="prefetch" href="/assets/js/101.0d7e4727.js"><link rel="prefetch" href="/assets/js/102.e09888c2.js"><link rel="prefetch" href="/assets/js/103.12c4db4a.js"><link rel="prefetch" href="/assets/js/104.917d85b3.js"><link rel="prefetch" href="/assets/js/105.2c8a97c2.js"><link rel="prefetch" href="/assets/js/106.137429f1.js"><link rel="prefetch" href="/assets/js/107.3dd3c2b0.js"><link rel="prefetch" href="/assets/js/108.ae0d09f1.js"><link rel="prefetch" href="/assets/js/109.05199ced.js"><link rel="prefetch" href="/assets/js/11.f4ce1d53.js"><link rel="prefetch" href="/assets/js/110.72857918.js"><link rel="prefetch" href="/assets/js/111.5c9c5ec1.js"><link rel="prefetch" href="/assets/js/112.4b4aa971.js"><link rel="prefetch" href="/assets/js/113.467b4f39.js"><link rel="prefetch" href="/assets/js/114.e37bc94a.js"><link rel="prefetch" href="/assets/js/115.e2033c8c.js"><link rel="prefetch" href="/assets/js/116.0f3bb3de.js"><link rel="prefetch" href="/assets/js/117.97f66c3d.js"><link rel="prefetch" href="/assets/js/118.61cc124c.js"><link rel="prefetch" href="/assets/js/119.70620c50.js"><link rel="prefetch" href="/assets/js/12.068e04f8.js"><link rel="prefetch" href="/assets/js/120.43a34ff2.js"><link rel="prefetch" href="/assets/js/121.80ec60ad.js"><link rel="prefetch" href="/assets/js/122.f38284d1.js"><link rel="prefetch" href="/assets/js/123.1dc518a3.js"><link rel="prefetch" href="/assets/js/124.5765d2e5.js"><link rel="prefetch" href="/assets/js/125.c734c24f.js"><link rel="prefetch" href="/assets/js/126.79b78b84.js"><link rel="prefetch" href="/assets/js/127.25ff388a.js"><link rel="prefetch" href="/assets/js/128.1496ac92.js"><link rel="prefetch" href="/assets/js/129.4e04e6cc.js"><link rel="prefetch" href="/assets/js/13.bda859e5.js"><link rel="prefetch" href="/assets/js/130.f107b701.js"><link rel="prefetch" href="/assets/js/131.08b783f2.js"><link rel="prefetch" href="/assets/js/14.2a400896.js"><link rel="prefetch" href="/assets/js/15.295d62fc.js"><link rel="prefetch" href="/assets/js/16.652a89b0.js"><link rel="prefetch" href="/assets/js/17.3be5eda0.js"><link rel="prefetch" href="/assets/js/18.32454e69.js"><link rel="prefetch" href="/assets/js/19.a08feb93.js"><link rel="prefetch" href="/assets/js/2.4b1d4bf3.js"><link rel="prefetch" href="/assets/js/20.34e166bb.js"><link rel="prefetch" href="/assets/js/21.1d2ef408.js"><link rel="prefetch" href="/assets/js/22.2a6cd144.js"><link rel="prefetch" href="/assets/js/23.5adcd431.js"><link rel="prefetch" href="/assets/js/24.9bccf9d1.js"><link rel="prefetch" href="/assets/js/25.d8fd4102.js"><link rel="prefetch" href="/assets/js/26.40635db2.js"><link rel="prefetch" href="/assets/js/27.9a5f2d44.js"><link rel="prefetch" href="/assets/js/28.2d385e7d.js"><link rel="prefetch" href="/assets/js/29.da082ef6.js"><link rel="prefetch" href="/assets/js/30.73aec03b.js"><link rel="prefetch" href="/assets/js/31.f86eee3a.js"><link rel="prefetch" href="/assets/js/32.46e321e1.js"><link rel="prefetch" href="/assets/js/33.e63e33f3.js"><link rel="prefetch" href="/assets/js/34.1d8e044f.js"><link rel="prefetch" href="/assets/js/35.af094489.js"><link rel="prefetch" href="/assets/js/37.7a620d2c.js"><link rel="prefetch" href="/assets/js/38.eac140f8.js"><link rel="prefetch" href="/assets/js/39.3a26a316.js"><link rel="prefetch" href="/assets/js/4.9ea4066c.js"><link rel="prefetch" href="/assets/js/40.c0974fab.js"><link rel="prefetch" href="/assets/js/41.62cd62ac.js"><link rel="prefetch" href="/assets/js/42.20944c6a.js"><link rel="prefetch" href="/assets/js/43.e88d32e5.js"><link rel="prefetch" href="/assets/js/44.9d1312b3.js"><link rel="prefetch" href="/assets/js/45.e68f16da.js"><link rel="prefetch" href="/assets/js/46.20ba1095.js"><link rel="prefetch" href="/assets/js/47.37709ee2.js"><link rel="prefetch" href="/assets/js/48.d96ab555.js"><link rel="prefetch" href="/assets/js/49.59fb3a5d.js"><link rel="prefetch" href="/assets/js/5.9c269fae.js"><link rel="prefetch" href="/assets/js/50.dd2320c1.js"><link rel="prefetch" href="/assets/js/51.99326924.js"><link rel="prefetch" href="/assets/js/52.2f8bdcae.js"><link rel="prefetch" href="/assets/js/53.b65c9b3b.js"><link rel="prefetch" href="/assets/js/54.8f1c1e12.js"><link rel="prefetch" href="/assets/js/55.abe1f4b6.js"><link rel="prefetch" href="/assets/js/56.1b79c9a4.js"><link rel="prefetch" href="/assets/js/57.97bf7386.js"><link rel="prefetch" href="/assets/js/58.eab2d512.js"><link rel="prefetch" href="/assets/js/59.dc4064e5.js"><link rel="prefetch" href="/assets/js/6.530b08db.js"><link rel="prefetch" href="/assets/js/60.6c9bd626.js"><link rel="prefetch" href="/assets/js/61.7d3b7f84.js"><link rel="prefetch" href="/assets/js/62.0a97fcb0.js"><link rel="prefetch" href="/assets/js/63.15d50454.js"><link rel="prefetch" href="/assets/js/64.9fe77f7e.js"><link rel="prefetch" href="/assets/js/65.d0f3dc77.js"><link rel="prefetch" href="/assets/js/66.75f6f323.js"><link rel="prefetch" href="/assets/js/67.997e57cb.js"><link rel="prefetch" href="/assets/js/68.c627100e.js"><link rel="prefetch" href="/assets/js/69.1757e396.js"><link rel="prefetch" href="/assets/js/7.393450db.js"><link rel="prefetch" href="/assets/js/70.4fead485.js"><link rel="prefetch" href="/assets/js/71.9d601385.js"><link rel="prefetch" href="/assets/js/72.df61f604.js"><link rel="prefetch" href="/assets/js/73.1ba6adec.js"><link rel="prefetch" href="/assets/js/74.dae5c946.js"><link rel="prefetch" href="/assets/js/75.ed1750af.js"><link rel="prefetch" href="/assets/js/76.23271b77.js"><link rel="prefetch" href="/assets/js/77.8f47131e.js"><link rel="prefetch" href="/assets/js/78.49a99228.js"><link rel="prefetch" href="/assets/js/79.66c05d68.js"><link rel="prefetch" href="/assets/js/8.afe1cb0f.js"><link rel="prefetch" href="/assets/js/80.14ebffb1.js"><link rel="prefetch" href="/assets/js/81.f69d7b2b.js"><link rel="prefetch" href="/assets/js/82.79ac4d75.js"><link rel="prefetch" href="/assets/js/83.5551e100.js"><link rel="prefetch" href="/assets/js/84.9d9dd0e5.js"><link rel="prefetch" href="/assets/js/85.41e7de0a.js"><link rel="prefetch" href="/assets/js/86.5ada016f.js"><link rel="prefetch" href="/assets/js/87.5cf495b9.js"><link rel="prefetch" href="/assets/js/88.2ac2cd3b.js"><link rel="prefetch" href="/assets/js/89.7816c1f3.js"><link rel="prefetch" href="/assets/js/9.828672e1.js"><link rel="prefetch" href="/assets/js/90.c5ba453d.js"><link rel="prefetch" href="/assets/js/91.257808f3.js"><link rel="prefetch" href="/assets/js/92.0425b893.js"><link rel="prefetch" href="/assets/js/93.caafd925.js"><link rel="prefetch" href="/assets/js/94.190ec2a0.js"><link rel="prefetch" href="/assets/js/95.3fbee9bb.js"><link rel="prefetch" href="/assets/js/96.ced1da5b.js"><link rel="prefetch" href="/assets/js/97.b518b74f.js"><link rel="prefetch" href="/assets/js/98.09a32c0b.js"><link rel="prefetch" href="/assets/js/99.503bd021.js">
    <link rel="stylesheet" href="/assets/css/0.styles.77284882.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="wrapper" data-v-586e078c><header class="header-right flex" data-v-6f1c53dc data-v-586e078c><div class="flex" data-v-6f1c53dc><div class="sidebar-button" data-v-6f1c53dc><svg width="25px" height="20px" viewBox="0 0 25 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="icon"><title>Hamburger menu button</title> <g transform="translate(-22.000000, -2.000000)"><g transform="translate(22.000000, 2.545974)"><path d="M24.7714844,0.5 L0,0.5"></path> <path d="M24.7714844,9.72701303 L0,9.72701303"></path> <path d="M24.7714844,18.9540261 L0,18.9540261"></path></g></g></svg> <a href="/" class="home-link router-link-active"><span class="site-name">Smilo</span></a></div> <a href="/" class="router-link-active" data-v-6f1c53dc><img src="/assets/img/ethereum-logo-wireframe.8c2f2894.png" alt="Smilo Logo" class="header-logo sm-hide" data-v-6f1c53dc></a> <nav class="nav-links sm-hide" data-v-6f1c53dc><ul class="nav-ul"><li class="nav-item"><a href="/" class="nav-link">Smilo</a></li><li class="nav-item"><a href="/beginners/" class="nav-link">Beginners</a></li><li class="nav-item"><a href="/use/" class="nav-link">Use</a></li><li class="nav-item"><a href="/learn/" class="nav-link">Learn</a></li><li class="nav-item"><a href="/developers/" class="nav-link">Developers</a></li> <!----></ul></nav></div> <div class="menu inline flex flex-center" data-v-6f1c53dc><div class="search-box" data-v-6f1c53dc><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="https://github.com/smilofoundation/smilo-foundation-website" target="_blank" title="Fork This Page (Github)" data-v-6f1c53dc><img alt="Github" src="/assets/img/icon-github.3720c649.svg" class="hide-dark" data-v-6f1c53dc> <img alt="Github" src="/assets/img/icon-github-white.e05d488b.svg" class="show-dark" data-v-6f1c53dc></a> <span class="pointer view-mode" data-v-6f1c53dc><img alt="Switch to Dark Mode" src="/assets/img/icon-sun.f0087fa4.svg" class="hide-dark" data-v-6f1c53dc> <img alt="Switch to Light Mode" src="/assets/img/icon-moon.0d522939.svg" class="show-dark" data-v-6f1c53dc></span> <div class="dropdown-wrapper sm-hide" data-v-6f1c53dc><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/How-To-Guides/add_node_examples.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/ko/" class="nav-link">Korean</a></li></ul></div></div></header> <!----> <main class="page" data-v-586e078c><div class="content__default" data-v-586e078c><h1 id="node-addition-examples"><a href="#node-addition-examples" aria-hidden="true" class="header-anchor">↳</a> Node addition examples</h1> <p>Below are some scenarios for adding a new node into a network, with a mix of different options such as
consensus algorithm, permissioning and discovery.</p> <p>You can find the resources required to run the examples in the
<a href="https://github.com/smilofoundation/Smilo-examples/tree/master/examples/adding_nodes" target="_blank" rel="noopener noreferrer">Smilo-examples<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a> repository.
Checkout the repository through <code>git</code> or otherwise download all the resources your local machine to follow along.</p> <p>The examples use <code>docker-compose</code> for the container definitions. If you are following along by copying the commands
described, then it is important to set the project name for Docker Compose, or to remember to change the prefix for
your directory. See <a href="https://docs.docker.com/compose/reference/envvars/#compose_project_name" target="_blank" rel="noopener noreferrer">Docker documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
for more details.</p> <p>To set the project name, run the following:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">COMPOSE_PROJECT_NAME</span><span class="token operator">=</span>addnode
</code></pre></div><h2 id="non-permimssioned-ibft-with-discovery"><a href="#non-permimssioned-ibft-with-discovery" aria-hidden="true" class="header-anchor">↳</a> Non-permimssioned IBFT with discovery</h2> <p>An example using IBFT, no permissioning and discover enabled via a bootnode.
There are no static peers in this network; instead, every node is set to talk to node 1 via the CLI flag
<code>--bootnodes enode://ac6b1096ca56b9f6d004b779ae3728bf83f8e22453404cc3cef16a3d9b96608bc67c4b30db88e0a5a6c6390213f7acbe1153ff6d23ce57380104288ae19373ef@172.16.239.11:21000</code>.
Node 1 will forward the details of all the nodes it knows about (in this case, everyone) and they will then initiate their
own connections.</p> <ol><li><p>Bring up an initial network of 6 nodes.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Ensure any old network is removed</span>
$ docker-compose -f ibft-non-perm-bootnode.yml down
<span class="token comment"># Bring up 6 nodes</span>
$ docker-compose -f ibft-non-perm-bootnode.yml up node1 node2 node3 node4 node5 node6
</code></pre></div></li> <li><p>Send in a public transaction and check it is minted.</p> <p>!!! note
* The block creation period is set to 2 seconds, so you may have to wait upto that amount of time for the transaction to be minted.
* The transaction hashes will likely be different, but the contract addresses will be the same for your network.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Send in the transaction</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'loadScript(&quot;/examples/public-contract.js&quot;)'</span> attach /qdata/dd/geth.ipc
Contract transaction send: TransactionHash: 0xd1bf0c15546802e5a121f79d0d8e6f0fa45d4961ef8ab9598885d28084cfa909 waiting to be mined<span class="token punctuation">..</span>.
<span class="token boolean">true</span>
<span class="token comment"># Retrieve the value of the contract</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1932c48b2bf8102ba33b4a6b545c32236e342f34&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">42</span>
</code></pre></div><p>We created a transaction, in this case with hash <code>0xd1bf0c15546802e5a121f79d0d8e6f0fa45d4961ef8ab9598885d28084cfa909</code>,
and then retrieved its value, which was set to be <code>42</code>.</p></li> <li><p>Bring up the last node. This node also has its bootnodes set to be node 1, so at startup will try to establish a
connection to node 1 only. After this, node 1 will share which nodes it knows about, and node 7 can then initiate
connections with those peers.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Bring up node 7</span>
$ docker-compose -f ibft-non-perm-bootnode.yml up node7
</code></pre></div></li> <li><p>Let's check to see if the nodes are in sync. If they are, they will have similar block numbers, which is enough for
this example; there are other ways to tell if nodes are on the same chain, e.g. matching block hashes.</p> <p>!!! note
Depending on timing, the second may have an extra block or two.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Fetch the latest block number for node 1</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'eth.blockNumber'</span> attach /qdata/dd/geth.ipc
<span class="token number">45</span>
<span class="token comment"># Fetch the latest block number for node 7</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node7_1 geth --exec <span class="token string">'eth.blockNumber'</span> attach /qdata/dd/geth.ipc
<span class="token number">45</span>
</code></pre></div></li> <li><p>We can check that the transaction and contract we sent earlier now exist on node 7.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it addnode_node7_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1932c48b2bf8102ba33b4a6b545c32236e342f34&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">42</span>
</code></pre></div></li> <li><p>To be sure we have two way communication, let's send a transaction from node 7 to the network.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it addnode_node7_1 geth --exec <span class="token string">'loadScript(&quot;/examples/public-contract.js&quot;)'</span> attach /qdata/dd/geth.ipc
Contract transaction send: TransactionHash: 0x84cefc3aab8ce5797dc73c70db604e5c8830fc7c2cf215876eb34fff533e2725 waiting to be mined<span class="token punctuation">..</span>.
<span class="token boolean">true</span>
</code></pre></div></li> <li><p>Finally, we can check if the transaction was minted and the contract executed on each node.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Check on node 1</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1349f3e1b8d71effb47b840594ff27da7e603d17&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">42</span>
<span class="token comment"># Check on node 7</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node7_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1349f3e1b8d71effb47b840594ff27da7e603d17&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">42</span>
</code></pre></div></li></ol> <p>And that's it. We deployed a working 6 node network, and then added a 7th node afterwards; this 7th node was able to
read existing public data, as well as deploy its own transactions and contracts for others to see!</p> <h2 id="non-permissioned-raft-with-discovery-disabled"><a href="#non-permissioned-raft-with-discovery-disabled" aria-hidden="true" class="header-anchor">↳</a> Non-permissioned RAFT with discovery disabled</h2> <p>This example walks through adding a new node to a RAFT network. This network does not have permissioning for the
Ethereum peer-to-peer layer, and makes it connections solely based on who is listed in the nodes <code>static-nodes.json</code>
file.</p> <ol><li><p>Bring up an initial network of 6 nodes.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Ensure any old network is removed</span>
$ docker-compose -f raft-non-perm-nodiscover.yml down
<span class="token comment"># Bring up 6 nodes</span>
$ docker-compose -f raft-non-perm-nodiscover.yml up node1 node2 node3 node4 node5 node6
</code></pre></div></li> <li><p>Send in a public transaction and check it is minted.</p> <p>!!! note
* The transaction hashes will likely be different, but the contract addresses will be the same for your network.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Send in the transaction</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'loadScript(&quot;/examples/public-contract.js&quot;)'</span> attach /qdata/dd/geth.ipc
Contract transaction send: TransactionHash: 0xd1bf0c15546802e5a121f79d0d8e6f0fa45d4961ef8ab9598885d28084cfa909 waiting to be mined<span class="token punctuation">..</span>.
<span class="token boolean">true</span>
<span class="token comment"># Retrieve the value of the contract</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1932c48b2bf8102ba33b4a6b545c32236e342f34&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">42</span>
</code></pre></div><p>We created a transaction, in this case with hash <code>0xd1bf0c15546802e5a121f79d0d8e6f0fa45d4961ef8ab9598885d28084cfa909</code>,
and then retrieved its value, which was set to be <code>42</code>.</p></li> <li><p>We need to add the new peer to the RAFT network before it joins, otherwise the existing nodes will reject it from
the RAFT communication layer; we also need to know what ID the new node should join with.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Add the new node</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'raft.addPeer(&quot;enode://239c1f044a2b03b6c4713109af036b775c5418fe4ca63b04b1ce00124af00ddab7cc088fc46020cdc783b6207efe624551be4c06a994993d8d70f684688fb7cf@172.16.239.17:21000?discport=0&amp;raftport=50400&quot;)'</span> attach /qdata/dd/geth.ipc
<span class="token number">7</span>
</code></pre></div><p>The return value is the RAFT ID of the new node. When the node joins the network for the first time, it will need
this ID number handy. If it was lost, you can always view the full network, including IDs, by running the
<code>raft.cluster</code> command on an existing node.</p></li> <li><p>Bring up the last node. Here, we pass the newly created ID number as a flag into the startup of node 7. This lets
the node know to not bootstrap a new network from the contents of <code>static-nodes.json</code>, but to connect to an existing
node there are fetch any bootstrap information.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Bring up node 7</span>
$ <span class="token assign-left variable">QUORUM_GETH_ARGS</span><span class="token operator">=</span><span class="token string">&quot;--raftjoinexisting 7&quot;</span> docker-compose -f raft-non-perm-nodiscover.yml up node7
</code></pre></div></li> <li><p>Let's check to see if the nodes are in sync. We can do by seeing if we have the contract that we viewer earlier on
node 7.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Fetch the contracts value on node 7</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node7_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1932c48b2bf8102ba33b4a6b545c32236e342f34&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">42</span>
</code></pre></div></li> <li><p>To be sure we have two way communication, let's send a transaction from node 7 to the network.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it addnode_node7_1 geth --exec <span class="token string">'loadScript(&quot;/examples/public-contract.js&quot;)'</span> attach /qdata/dd/geth.ipc
Contract transaction send: TransactionHash: 0x84cefc3aab8ce5797dc73c70db604e5c8830fc7c2cf215876eb34fff533e2725 waiting to be mined<span class="token punctuation">..</span>.
<span class="token boolean">true</span>
</code></pre></div></li> <li><p>Finally, we can check if the transaction was minted and the contract executed on each node.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Check on node 1</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1349f3e1b8d71effb47b840594ff27da7e603d17&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">42</span>
<span class="token comment"># Check on node 7</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node7_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1349f3e1b8d71effb47b840594ff27da7e603d17&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">42</span>
</code></pre></div></li></ol> <p>And that's it. We deployed a working 6 node network, and then added a 7th node afterwards; this 7th node was able to
read existing public data, as well as deploy its own transactions and contracts for others to see!</p> <h2 id="permissioned-raft-with-discovery-disabled"><a href="#permissioned-raft-with-discovery-disabled" aria-hidden="true" class="header-anchor">↳</a> Permissioned RAFT with discovery disabled</h2> <p>This example walks through adding a new node to a RAFT network. This network does have permissioning enabled for the
Ethereum peer-to-peer layer; this means that for any Ethereum tasks, such as syncing the initial blockchain or
propagating transactions, the node must appear is others nodes' <code>permissioned-nodes.json</code> file.</p> <ol><li><p>Bring up an initial network of 6 nodes.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Ensure any old network is removed</span>
$ docker-compose -f raft-perm-nodiscover.yml down
<span class="token comment"># Bring up 6 nodes</span>
$ docker-compose -f raft-perm-nodiscover.yml up node1 node2 node3 node4 node5 node6
</code></pre></div></li> <li><p>Send in a public transaction and check it is minted.</p> <p>!!! note
* The transaction hashes will likely be different, but the contract addresses will be the same for your network.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Send in the transaction</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'loadScript(&quot;/examples/public-contract.js&quot;)'</span> attach /qdata/dd/geth.ipc
Contract transaction send: TransactionHash: 0xd1bf0c15546802e5a121f79d0d8e6f0fa45d4961ef8ab9598885d28084cfa909 waiting to be mined<span class="token punctuation">..</span>.
<span class="token boolean">true</span>
<span class="token comment"># Retrieve the value of the contract</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1932c48b2bf8102ba33b4a6b545c32236e342f34&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">42</span>
</code></pre></div><p>We created a transaction, in this case with hash <code>0xd1bf0c15546802e5a121f79d0d8e6f0fa45d4961ef8ab9598885d28084cfa909</code>,
and then retrieved its value, which was set to be <code>42</code>.</p></li> <li><p>We need to add the new peer to the RAFT network before it joins, otherwise the existing nodes will reject it from
the RAFT communication layer; we also need to know what ID the new node should join with.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Add the new node</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'raft.addPeer(&quot;enode://239c1f044a2b03b6c4713109af036b775c5418fe4ca63b04b1ce00124af00ddab7cc088fc46020cdc783b6207efe624551be4c06a994993d8d70f684688fb7cf@172.16.239.17:21000?discport=0&amp;raftport=50400&quot;)'</span> attach /qdata/dd/geth.ipc
<span class="token number">7</span>
</code></pre></div><p>The return value is the RAFT ID of the new node. When the node joins the network for the first time, it will need
this ID number handy. If it was lost, you can always view the full network, including IDs, by running the
<code>raft.cluster</code> command on an existing node.</p></li> <li><p>Bring up the last node. Here, we pass the newly created ID number as a flag into the startup of node 7. This lets
the node know to not bootstrap a new network from the contents of <code>static-nodes.json</code>, but to connect to an existing
node there are fetch any bootstrap information.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Bring up node 7</span>
$ <span class="token assign-left variable">QUORUM_GETH_ARGS</span><span class="token operator">=</span><span class="token string">&quot;--raftjoinexisting 7&quot;</span> docker-compose -f raft-non-perm-nodiscover.yml up node7
</code></pre></div></li> <li><p>Let's check to see if the nodes are in sync. We can do by seeing if we have the contract that we viewer earlier on
node 7.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Fetch the contracts value on node 7</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node7_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1932c48b2bf8102ba33b4a6b545c32236e342f34&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">0</span>
</code></pre></div><p>The value here is <code>0</code>, not the expected <code>42</code>! Node 7 is unable to sync the blockchain because the other peers in the
network are refusing to allow connections from node 7, due to it being missing in the <code>permissioned-nodes.json</code> file.</p> <p>This does not affect the RAFT layer, so if node 7 was already is sync, it could still receive new blocks; this is
okay though, since it would be permissioned on the RAFT side by virtue of being part of the RAFT cluster.</p></li> <li><p>Let's update the permissioned nodes list on node 1, which will allow node 7 to connect to it.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 <span class="token function">cp</span> /extradata/static-nodes-7.json /qdata/dd/permissioned-nodes.json
$
</code></pre></div></li> <li><p>Node 7 should now be synced up through node 1. Let's see if we can see the contract we made earlier.</p> <p>!!! note
Smilo attempts to re-establish nodes every 30 seconds, so you may have to wait for the sync to happen.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it addnode_node7_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1932c48b2bf8102ba33b4a6b545c32236e342f34&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">42</span>
</code></pre></div></li> <li><p>To be sure we have two way communication, let's send a transaction from node 7 to the network.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it addnode_node7_1 geth --exec <span class="token string">'loadScript(&quot;/examples/public-contract.js&quot;)'</span> attach /qdata/dd/geth.ipc
Contract transaction send: TransactionHash: 0x84cefc3aab8ce5797dc73c70db604e5c8830fc7c2cf215876eb34fff533e2725 waiting to be mined<span class="token punctuation">..</span>.
<span class="token boolean">true</span>
</code></pre></div></li> <li><p>Finally, we can check if the transaction was minted and the contract executed on each node.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Check on node 1</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1349f3e1b8d71effb47b840594ff27da7e603d17&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">42</span>
<span class="token comment"># Check on node 7</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node7_1 geth --exec <span class="token string">'var private = eth.contract([{&quot;constant&quot;:true,&quot;inputs&quot;:[],&quot;name&quot;:&quot;get&quot;,&quot;outputs&quot;:[{&quot;name&quot;:&quot;retVal&quot;,&quot;type&quot;:&quot;uint256&quot;}],&quot;payable&quot;:false,&quot;type&quot;:&quot;function&quot;}]).at(&quot;0x1349f3e1b8d71effb47b840594ff27da7e603d17&quot;); private.get();'</span> attach /qdata/dd/geth.ipc
<span class="token number">42</span>
</code></pre></div></li></ol> <p>And that's it. We deployed a working 6 node network, and then added a 7th node afterwards; this 7th node was able to
read existing public data, as well as deploy its own transactions and contracts for others to see!</p> <h2 id="adding-a-private-transaction-manager"><a href="#adding-a-private-transaction-manager" aria-hidden="true" class="header-anchor">↳</a> Adding a Private Transaction Manager</h2> <p>This is a simple example of adding a new Tessera instance to an existing network. For simplicity,
the steps to add the Smilo node are omitted, but are those followed in the IBFT example.
Here, a Tessera node is added without any of the discovery options specified, meaning that the
IP Whitelist isn't used, nor is key discovery disabled.</p> <ol><li><p>Start up the initial 6 node network.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Ensure any old network is removed</span>
$ docker-compose -f tessera-add.yml down
<span class="token comment"># Bring up 6 nodes</span>
$ docker-compose -f tessera-add.yml up node1 node2 node3 node4 node5 node6
</code></pre></div></li> <li><p>We can verify that private transactions can be sent by sending one from node 1 to node 6.
We can also see that since node 7 doesn't exist yet, we can't send private transactions to it.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Send a private transaction from node 1 to node 6</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'loadScript(&quot;/examples/private-contract-6.js&quot;)'</span> attach /qdata/dd/geth.ipc
Contract transaction send: TransactionHash: 0xc8a5de4bb79d4a8c3c1156917968ca9b2965f2514732fc1cff357ec999b9aba4 waiting to be mined<span class="token punctuation">..</span>.
<span class="token boolean">true</span>
<span class="token comment"># Success! </span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'loadScript(&quot;/examples/private-contract-7.js&quot;)'</span> attach /qdata/dd/geth.ipc
err creating contract Error: Non-200 status code: <span class="token operator">&amp;</span><span class="token punctuation">{</span>Status:404 Not Found StatusCode:404 Proto:HTTP/1.1 ProtoMajor:1 ProtoMinor:1 Header:map<span class="token punctuation">[</span>Server:<span class="token punctuation">[</span>Jetty<span class="token punctuation">(</span><span class="token number">9.4</span>.z-SNAPSHOT<span class="token punctuation">)</span><span class="token punctuation">]</span> Date:<span class="token punctuation">[</span>Thu, <span class="token number">16</span> Jan <span class="token number">2020</span> <span class="token number">12</span>:44:19 GMT<span class="token punctuation">]</span> Content-Type:<span class="token punctuation">[</span>text/plain<span class="token punctuation">]</span> Content-Length:<span class="token punctuation">[</span><span class="token number">73</span><span class="token punctuation">]</span><span class="token punctuation">]</span> Body:0xc028e87d40 ContentLength:73 TransferEncoding:<span class="token punctuation">[</span><span class="token punctuation">]</span> Close:false Uncompressed:false Trailer:map<span class="token punctuation">[</span><span class="token punctuation">]</span> Request:0xc000287200 TLS:<span class="token operator">&lt;</span>nil<span class="token operator">&gt;</span><span class="token punctuation">}</span>
<span class="token boolean">true</span>
<span class="token comment"># An expected failure. The script content didn't succeed, but the script itself was run okay, so true was still returned</span>
</code></pre></div></li> <li><p>Let's first bring up node 7, then we can inspect what is happening and the configuration used.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Bring up node 7</span>
$ docker-compose -f tessera-add.yml up node7 
$ docker <span class="token builtin class-name">exec</span> -it addnode_node7_1 <span class="token function">cat</span> /qdata/tm/tessera-config.json
<span class="token comment"># ...some output...</span>
</code></pre></div><p>The last command will output Tessera 7's configuration.
The pieces we are interested in here are the following:</p> <div class="language-json extra-class"><pre class="language-json"><code><span class="token punctuation">{</span>
  <span class="token property">&quot;useWhiteList&quot;</span><span class="token operator">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
   <span class="token property">&quot;peer&quot;</span><span class="token operator">:</span> <span class="token punctuation">[</span>
      <span class="token punctuation">{</span>
          <span class="token property">&quot;url&quot;</span><span class="token operator">:</span> <span class="token string">&quot;http://txmanager1:9000&quot;</span>
      <span class="token punctuation">}</span>
   <span class="token punctuation">]</span><span class="token punctuation">,</span>
   ...
<span class="token punctuation">}</span>
</code></pre></div><p>We can see that the whitelist is not enabled, discovery is not specified so defaults to enabled,
and we have a single peer to start off with, which is node 1.
This is all that is needed to connect to an existing network. Shortly after starting up, Tessera
will ask node 1 about all it's peers, and then will keep a record of them for it's own use. From
then on, all the nodes will know about node 7 and can send private transactions to it.</p></li> <li><p>Let's try it! Let's send a private transaction from node 1 to the newly added node 7.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Sending a transaction from node 1 to node 7</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'loadScript(&quot;/examples/private-contract-7.js&quot;)'</span> attach /qdata/dd/geth.ipc
Contract transaction send: TransactionHash: 0x3e3b50768ffdb51979677ddb58f48abdabb82a3fd4f0bac5b3d1ad8014e954e9 waiting to be mined<span class="token punctuation">..</span>.
<span class="token boolean">true</span>
</code></pre></div><p>We got a success this time! Tessera 7 has been accepted into the network and can interact with the
other existing nodes.</p></li></ol></div></main> <div class="sidebar" data-v-586e078c><nav class="nav-links"><ul class="nav-ul"><li class="nav-item"><a href="/" class="nav-link">Smilo</a></li><li class="nav-item"><a href="/beginners/" class="nav-link">Beginners</a></li><li class="nav-item"><a href="/use/" class="nav-link">Use</a></li><li class="nav-item"><a href="/learn/" class="nav-link">Learn</a></li><li class="nav-item"><a href="/developers/" class="nav-link">Developers</a></li> <div class="dropdown-wrapper nav-item"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/How-To-Guides/add_node_examples.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/ko/" class="nav-link">Korean</a></li></ul></div></ul></nav>  <!----> </div> <footer class="footer" data-v-ca550d00 data-v-586e078c><div class="credits" data-v-ca550d00>
    Artwork by <a href="https://impermanence.co" target="_blank" data-v-ca550d00>Lili Feyerabend</a> feat. <a href="https://ilankatin.com" target="_blank" data-v-ca550d00>ilan katin</a>, <a href="https://linktr.ee/mattiacprodukt" target="_blank" data-v-ca550d00>Mattia Cuttini</a>, <a href="https://oficinastk.github.io" target="_blank" data-v-ca550d00>Oficinas TK</a>, <a href="https://xcopyart.com" target="_blank" data-v-ca550d00>XCOPY</a>.
  </div> <ul data-v-ca550d00><li data-v-ca550d00><a href="https://github.com/smilofoundation" target="_blank" data-v-ca550d00>GitHub</a></li> <li data-v-ca550d00><a href="https://twitter.com/smiloplatform" target="_blank" data-v-ca550d00>Twitter</a></li> <li data-v-ca550d00><a href="https://blog.smilo.foundation/" data-v-ca550d00>Blog</a></li> <li data-v-ca550d00><a href="/privacy-policy/" data-v-ca550d00>Privacy Policy</a></li> <li data-v-ca550d00><a href="/terms-of-use/" data-v-ca550d00>Terms of Use</a></li> <li data-v-ca550d00><a href="/cookie-policy/" data-v-ca550d00>Cookie Policy</a></li> <li data-v-ca550d00><a href="mailto:info@smilo.foundation" data-v-ca550d00>Contact</a></li></ul></footer> <a href="https://hackernoon.com/rethinking-the-identity-of-ethereumorg-l718w347l" target="_blank" data-v-586e078c><button class="announcement" data-v-586e078c>
      Read about the new artwork! <span class="accent" data-v-586e078c>→  More</span></button></a></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1c5a03b7.js" defer></script><script src="/assets/js/3.030594d3.js" defer></script><script src="/assets/js/36.fd9805c3.js" defer></script>
  </body>
</html>
