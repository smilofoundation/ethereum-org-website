<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>Adding and removing IBFT validators | Smilo</title>
    <meta name="description" content="">
    <meta/ name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,maximum-scale=1"></meta/>
  <link rel="icon" type="image/png" href="/favicon.png">
  <meta property="og:type" content="website">
  <meta property="og:site_name" content="smilo.foundation">
  <meta property="og:url" content="https://smilo.foundation">
  <meta property="og:image" content="https://smilo.foundation/og-image.png">
  <meta property="twitter:card" content="summary_large_image">
  <meta property="twitter:site" content="@smiloplatform">
  <meta property="twitter:creator" content="@smiloplatform">
  <meta property="twitter:image" content="https://smilo.foundation/og-image-twitter.png">
    <link rel="preload" href="/assets/css/0.styles.77284882.css" as="style"><link rel="preload" href="/assets/js/app.1c5a03b7.js" as="script"><link rel="preload" href="/assets/js/3.030594d3.js" as="script"><link rel="preload" href="/assets/js/35.af094489.js" as="script"><link rel="prefetch" href="/assets/js/10.6e3e9273.js"><link rel="prefetch" href="/assets/js/100.54f82e92.js"><link rel="prefetch" href="/assets/js/101.0d7e4727.js"><link rel="prefetch" href="/assets/js/102.e09888c2.js"><link rel="prefetch" href="/assets/js/103.12c4db4a.js"><link rel="prefetch" href="/assets/js/104.917d85b3.js"><link rel="prefetch" href="/assets/js/105.2c8a97c2.js"><link rel="prefetch" href="/assets/js/106.137429f1.js"><link rel="prefetch" href="/assets/js/107.3dd3c2b0.js"><link rel="prefetch" href="/assets/js/108.ae0d09f1.js"><link rel="prefetch" href="/assets/js/109.05199ced.js"><link rel="prefetch" href="/assets/js/11.f4ce1d53.js"><link rel="prefetch" href="/assets/js/110.72857918.js"><link rel="prefetch" href="/assets/js/111.5c9c5ec1.js"><link rel="prefetch" href="/assets/js/112.4b4aa971.js"><link rel="prefetch" href="/assets/js/113.467b4f39.js"><link rel="prefetch" href="/assets/js/114.e37bc94a.js"><link rel="prefetch" href="/assets/js/115.e2033c8c.js"><link rel="prefetch" href="/assets/js/116.0f3bb3de.js"><link rel="prefetch" href="/assets/js/117.97f66c3d.js"><link rel="prefetch" href="/assets/js/118.61cc124c.js"><link rel="prefetch" href="/assets/js/119.70620c50.js"><link rel="prefetch" href="/assets/js/12.068e04f8.js"><link rel="prefetch" href="/assets/js/120.43a34ff2.js"><link rel="prefetch" href="/assets/js/121.80ec60ad.js"><link rel="prefetch" href="/assets/js/122.f38284d1.js"><link rel="prefetch" href="/assets/js/123.1dc518a3.js"><link rel="prefetch" href="/assets/js/124.5765d2e5.js"><link rel="prefetch" href="/assets/js/125.c734c24f.js"><link rel="prefetch" href="/assets/js/126.79b78b84.js"><link rel="prefetch" href="/assets/js/127.25ff388a.js"><link rel="prefetch" href="/assets/js/128.1496ac92.js"><link rel="prefetch" href="/assets/js/129.4e04e6cc.js"><link rel="prefetch" href="/assets/js/13.bda859e5.js"><link rel="prefetch" href="/assets/js/130.f107b701.js"><link rel="prefetch" href="/assets/js/131.08b783f2.js"><link rel="prefetch" href="/assets/js/14.2a400896.js"><link rel="prefetch" href="/assets/js/15.295d62fc.js"><link rel="prefetch" href="/assets/js/16.652a89b0.js"><link rel="prefetch" href="/assets/js/17.3be5eda0.js"><link rel="prefetch" href="/assets/js/18.32454e69.js"><link rel="prefetch" href="/assets/js/19.a08feb93.js"><link rel="prefetch" href="/assets/js/2.4b1d4bf3.js"><link rel="prefetch" href="/assets/js/20.34e166bb.js"><link rel="prefetch" href="/assets/js/21.1d2ef408.js"><link rel="prefetch" href="/assets/js/22.2a6cd144.js"><link rel="prefetch" href="/assets/js/23.5adcd431.js"><link rel="prefetch" href="/assets/js/24.9bccf9d1.js"><link rel="prefetch" href="/assets/js/25.d8fd4102.js"><link rel="prefetch" href="/assets/js/26.40635db2.js"><link rel="prefetch" href="/assets/js/27.9a5f2d44.js"><link rel="prefetch" href="/assets/js/28.2d385e7d.js"><link rel="prefetch" href="/assets/js/29.da082ef6.js"><link rel="prefetch" href="/assets/js/30.73aec03b.js"><link rel="prefetch" href="/assets/js/31.f86eee3a.js"><link rel="prefetch" href="/assets/js/32.46e321e1.js"><link rel="prefetch" href="/assets/js/33.e63e33f3.js"><link rel="prefetch" href="/assets/js/34.1d8e044f.js"><link rel="prefetch" href="/assets/js/36.fd9805c3.js"><link rel="prefetch" href="/assets/js/37.7a620d2c.js"><link rel="prefetch" href="/assets/js/38.eac140f8.js"><link rel="prefetch" href="/assets/js/39.3a26a316.js"><link rel="prefetch" href="/assets/js/4.9ea4066c.js"><link rel="prefetch" href="/assets/js/40.c0974fab.js"><link rel="prefetch" href="/assets/js/41.62cd62ac.js"><link rel="prefetch" href="/assets/js/42.20944c6a.js"><link rel="prefetch" href="/assets/js/43.e88d32e5.js"><link rel="prefetch" href="/assets/js/44.9d1312b3.js"><link rel="prefetch" href="/assets/js/45.e68f16da.js"><link rel="prefetch" href="/assets/js/46.20ba1095.js"><link rel="prefetch" href="/assets/js/47.37709ee2.js"><link rel="prefetch" href="/assets/js/48.d96ab555.js"><link rel="prefetch" href="/assets/js/49.59fb3a5d.js"><link rel="prefetch" href="/assets/js/5.9c269fae.js"><link rel="prefetch" href="/assets/js/50.dd2320c1.js"><link rel="prefetch" href="/assets/js/51.99326924.js"><link rel="prefetch" href="/assets/js/52.2f8bdcae.js"><link rel="prefetch" href="/assets/js/53.b65c9b3b.js"><link rel="prefetch" href="/assets/js/54.8f1c1e12.js"><link rel="prefetch" href="/assets/js/55.abe1f4b6.js"><link rel="prefetch" href="/assets/js/56.1b79c9a4.js"><link rel="prefetch" href="/assets/js/57.97bf7386.js"><link rel="prefetch" href="/assets/js/58.eab2d512.js"><link rel="prefetch" href="/assets/js/59.dc4064e5.js"><link rel="prefetch" href="/assets/js/6.530b08db.js"><link rel="prefetch" href="/assets/js/60.6c9bd626.js"><link rel="prefetch" href="/assets/js/61.7d3b7f84.js"><link rel="prefetch" href="/assets/js/62.0a97fcb0.js"><link rel="prefetch" href="/assets/js/63.15d50454.js"><link rel="prefetch" href="/assets/js/64.9fe77f7e.js"><link rel="prefetch" href="/assets/js/65.d0f3dc77.js"><link rel="prefetch" href="/assets/js/66.75f6f323.js"><link rel="prefetch" href="/assets/js/67.997e57cb.js"><link rel="prefetch" href="/assets/js/68.c627100e.js"><link rel="prefetch" href="/assets/js/69.1757e396.js"><link rel="prefetch" href="/assets/js/7.393450db.js"><link rel="prefetch" href="/assets/js/70.4fead485.js"><link rel="prefetch" href="/assets/js/71.9d601385.js"><link rel="prefetch" href="/assets/js/72.df61f604.js"><link rel="prefetch" href="/assets/js/73.1ba6adec.js"><link rel="prefetch" href="/assets/js/74.dae5c946.js"><link rel="prefetch" href="/assets/js/75.ed1750af.js"><link rel="prefetch" href="/assets/js/76.23271b77.js"><link rel="prefetch" href="/assets/js/77.8f47131e.js"><link rel="prefetch" href="/assets/js/78.49a99228.js"><link rel="prefetch" href="/assets/js/79.66c05d68.js"><link rel="prefetch" href="/assets/js/8.afe1cb0f.js"><link rel="prefetch" href="/assets/js/80.14ebffb1.js"><link rel="prefetch" href="/assets/js/81.f69d7b2b.js"><link rel="prefetch" href="/assets/js/82.79ac4d75.js"><link rel="prefetch" href="/assets/js/83.5551e100.js"><link rel="prefetch" href="/assets/js/84.9d9dd0e5.js"><link rel="prefetch" href="/assets/js/85.41e7de0a.js"><link rel="prefetch" href="/assets/js/86.5ada016f.js"><link rel="prefetch" href="/assets/js/87.5cf495b9.js"><link rel="prefetch" href="/assets/js/88.2ac2cd3b.js"><link rel="prefetch" href="/assets/js/89.7816c1f3.js"><link rel="prefetch" href="/assets/js/9.828672e1.js"><link rel="prefetch" href="/assets/js/90.c5ba453d.js"><link rel="prefetch" href="/assets/js/91.257808f3.js"><link rel="prefetch" href="/assets/js/92.0425b893.js"><link rel="prefetch" href="/assets/js/93.caafd925.js"><link rel="prefetch" href="/assets/js/94.190ec2a0.js"><link rel="prefetch" href="/assets/js/95.3fbee9bb.js"><link rel="prefetch" href="/assets/js/96.ced1da5b.js"><link rel="prefetch" href="/assets/js/97.b518b74f.js"><link rel="prefetch" href="/assets/js/98.09a32c0b.js"><link rel="prefetch" href="/assets/js/99.503bd021.js">
    <link rel="stylesheet" href="/assets/css/0.styles.77284882.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div id="wrapper" data-v-586e078c><header class="header-right flex" data-v-6f1c53dc data-v-586e078c><div class="flex" data-v-6f1c53dc><div class="sidebar-button" data-v-6f1c53dc><svg width="25px" height="20px" viewBox="0 0 25 20" xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" class="icon"><title>Hamburger menu button</title> <g transform="translate(-22.000000, -2.000000)"><g transform="translate(22.000000, 2.545974)"><path d="M24.7714844,0.5 L0,0.5"></path> <path d="M24.7714844,9.72701303 L0,9.72701303"></path> <path d="M24.7714844,18.9540261 L0,18.9540261"></path></g></g></svg> <a href="/" class="home-link router-link-active"><span class="site-name">Smilo</span></a></div> <a href="/" class="router-link-active" data-v-6f1c53dc><img src="/assets/img/ethereum-logo-wireframe.8c2f2894.png" alt="Smilo Logo" class="header-logo sm-hide" data-v-6f1c53dc></a> <nav class="nav-links sm-hide" data-v-6f1c53dc><ul class="nav-ul"><li class="nav-item"><a href="/" class="nav-link">Smilo</a></li><li class="nav-item"><a href="/beginners/" class="nav-link">Beginners</a></li><li class="nav-item"><a href="/use/" class="nav-link">Use</a></li><li class="nav-item"><a href="/learn/" class="nav-link">Learn</a></li><li class="nav-item"><a href="/developers/" class="nav-link">Developers</a></li> <!----></ul></nav></div> <div class="menu inline flex flex-center" data-v-6f1c53dc><div class="search-box" data-v-6f1c53dc><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <a href="https://github.com/smilofoundation/smilo-foundation-website" target="_blank" title="Fork This Page (Github)" data-v-6f1c53dc><img alt="Github" src="/assets/img/icon-github.3720c649.svg" class="hide-dark" data-v-6f1c53dc> <img alt="Github" src="/assets/img/icon-github-white.e05d488b.svg" class="show-dark" data-v-6f1c53dc></a> <span class="pointer view-mode" data-v-6f1c53dc><img alt="Switch to Dark Mode" src="/assets/img/icon-sun.f0087fa4.svg" class="hide-dark" data-v-6f1c53dc> <img alt="Switch to Light Mode" src="/assets/img/icon-moon.0d522939.svg" class="show-dark" data-v-6f1c53dc></span> <div class="dropdown-wrapper sm-hide" data-v-6f1c53dc><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/How-To-Guides/add_ibft_validator.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/ko/" class="nav-link">Korean</a></li></ul></div></div></header> <!----> <main class="page" data-v-586e078c><div class="content__default" data-v-586e078c><h1 id="adding-and-removing-ibft-validators"><a href="#adding-and-removing-ibft-validators" aria-hidden="true" class="header-anchor">↳</a> Adding and removing IBFT validators</h1> <p>Over the lifetime of an IBFT network, validators will need to be added and removed as authorities change.
Here we will showcase adding a new validator to an IBFT network, as well as removing an existing one.</p> <h2 id="adding-a-node-to-the-validator-set"><a href="#adding-a-node-to-the-validator-set" aria-hidden="true" class="header-anchor">↳</a> Adding a node to the validator set</h2> <p>Adding a node to the IBFT validator set is relatively easy once a node is part of the network.
It does not matter whether the node is already online or not, as the process to add the new node as a validator only
needs the <em>existing</em> validators.</p> <p>!!! warning
If you are adding multiple validators before they are brought online, make sure you don't go over the BFT limit and cause the chain to stop progressing.</p> <p>Adding a new validator requires that a majority of existing validators propose the new node to be added. This is
achieved by calling the <code>propose</code> RPC method with the value <code>true</code> and replacing the address to your required one:</p> <pre><code>```bash
$ geth attach /qdata/dd/geth.ipc
&gt; istanbul.propose(&quot;0xb131288f355bc27090e542ae0be213c20350b767&quot;, true);
null
```
</code></pre> <p>This indicates that the current node wishes to add address <code>0xb131288f355bc27090e542ae0be213c20350b767</code> as a new
validator.</p> <h3 id="example"><a href="#example" aria-hidden="true" class="header-anchor">↳</a> Example</h3> <p>You can find the resources required to run the examples in the
<a href="https://github.com/smilofoundation/Smilo-examples/tree/master/examples/ibft_validator_set_changes" target="_blank" rel="noopener noreferrer">Smilo-examples<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
repository.</p> <ol><li><p>The examples use <code>docker-compose</code> for the container definitions. If you are following along by copying the commands
described, then it is important to set the project name for Docker Compose, or to remember to change the prefix for
your directory. See <a href="https://docs.docker.com/compose/reference/envvars/#compose_project_name" target="_blank" rel="noopener noreferrer">Docker documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
for more details.</p> <p>To set the project name, run the following:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">COMPOSE_PROJECT_NAME</span><span class="token operator">=</span>addnode
</code></pre></div></li> <li><p>Bring up the network, which contains 7 nodes, of which 6 are validators.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker-compose -f ibft-6-validators.yml up
</code></pre></div><p>We will be adding the 7th node as a validator. You may notice in the logs of node 7 messages along the lines of
<code>node7_1 | WARN [01-20|10:37:16.034] Block sealing failed err=unauthorized</code>. This is because
the node was started up with minting enabled, but doesn't have the authority to create blocks, and so throws this
error.</p></li> <li><p>Now we need to propose node 7 as a new proposer from the existing nodes.</p> <p>!!! note
Remember, you could do this stage before starting node 7 in your network</p> <p>We need a majority of existing validators to propose the new node before the changes will take effect.</p> <p>Lets start with node 1 and see what happens:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Propose node 7 from node 1</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'istanbul.propose(&quot;0xb131288f355bc27090e542ae0be213c20350b767&quot;, true);'</span> attach /qdata/dd/geth.ipc
null
<span class="token comment"># Wait about 5 seconds, and then run:</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'istanbul.getSnapshot();'</span> attach /qdata/dd/geth.ipc
<span class="token punctuation">{</span>
  epoch: <span class="token number">30000</span>,
  hash: <span class="token string">&quot;0xf814863d809ce3a683ee0a2197b15a8152d2696fc9c4e47cd82d0bd5cdaa3e45&quot;</span>,
  number: <span class="token number">269</span>,
  policy: <span class="token number">0</span>,
  tally: <span class="token punctuation">{</span>
    0xb131288f355bc27090e542ae0be213c20350b767: <span class="token punctuation">{</span>
      authorize: true,
      votes: <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  validators: <span class="token punctuation">[</span><span class="token string">&quot;0x6571d97f340c8495b661a823f2c2145ca47d63c2&quot;</span>, <span class="token string">&quot;0x8157d4437104e3b8df4451a85f7b2438ef6699ff&quot;</span>, <span class="token string">&quot;0xb912de287f9b047b4228436e94b5b78e3ee16171&quot;</span>, <span class="token string">&quot;0xd8dba507e85f116b1f7e231ca8525fc9008a6966&quot;</span>, <span class="token string">&quot;0xe36cbeb565b061217930767886474e3cde903ac5&quot;</span>, <span class="token string">&quot;0xf512a992f3fb749857d758ffda1330e590fa915e&quot;</span><span class="token punctuation">]</span>,
  votes: <span class="token punctuation">[</span><span class="token punctuation">{</span>
      address: <span class="token string">&quot;0xb131288f355bc27090e542ae0be213c20350b767&quot;</span>,
      authorize: true,
      block: <span class="token number">268</span>,
      validator: <span class="token string">&quot;0xd8dba507e85f116b1f7e231ca8525fc9008a6966&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Let's break this down.
Firstly, we proposed the address <code>0xb131288f355bc27090e542ae0be213c20350b767</code> to be added; that is what the <code>true</code>
parameter is for. If we had set it to <code>false</code>, that means we want to remove an existing validator with that address.</p> <p>Secondly, we fetched the current snapshot, which gives us an insight into the current running state of the voting.
We can see that the new address has 1 vote under the <code>tally</code> section, and that one vote is described under the
<code>votes</code> section. So we know our vote was registered!</p></li> <li><p>Let's run this from node 2 and see similar results:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it addnode_node2_1 geth --exec <span class="token string">'istanbul.propose(&quot;0xb131288f355bc27090e542ae0be213c20350b767&quot;, true);'</span> attach /qdata/dd/geth.ipc
null
<span class="token comment"># Again, you may have to wait 5 - 10 seconds for the snapshot to show the vote</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node2_1 geth --exec <span class="token string">'istanbul.getSnapshot();'</span> attach /qdata/dd/geth.ipc
<span class="token punctuation">{</span>
  epoch: <span class="token number">30000</span>,
  hash: <span class="token string">&quot;0x93efcd458f3b875902a4532bb77d5e7ebb701791ea95486ecd58baf682312d74&quot;</span>,
  number: <span class="token number">391</span>,
  policy: <span class="token number">0</span>,
  tally: <span class="token punctuation">{</span>
    0xb131288f355bc27090e542ae0be213c20350b767: <span class="token punctuation">{</span>
      authorize: true,
      votes: <span class="token number">2</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  validators: <span class="token punctuation">[</span><span class="token string">&quot;0x6571d97f340c8495b661a823f2c2145ca47d63c2&quot;</span>, <span class="token string">&quot;0x8157d4437104e3b8df4451a85f7b2438ef6699ff&quot;</span>, <span class="token string">&quot;0xb912de287f9b047b4228436e94b5b78e3ee16171&quot;</span>, <span class="token string">&quot;0xd8dba507e85f116b1f7e231ca8525fc9008a6966&quot;</span>, <span class="token string">&quot;0xe36cbeb565b061217930767886474e3cde903ac5&quot;</span>, <span class="token string">&quot;0xf512a992f3fb749857d758ffda1330e590fa915e&quot;</span><span class="token punctuation">]</span>,
  votes: <span class="token punctuation">[</span><span class="token punctuation">{</span>
      address: <span class="token string">&quot;0xb131288f355bc27090e542ae0be213c20350b767&quot;</span>,
      authorize: true,
      block: <span class="token number">388</span>,
      validator: <span class="token string">&quot;0xd8dba507e85f116b1f7e231ca8525fc9008a6966&quot;</span>
  <span class="token punctuation">}</span>, <span class="token punctuation">{</span>
      address: <span class="token string">&quot;0xb131288f355bc27090e542ae0be213c20350b767&quot;</span>,
      authorize: true,
      block: <span class="token number">390</span>,
      validator: <span class="token string">&quot;0x6571d97f340c8495b661a823f2c2145ca47d63c2&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>True to form, we have the second vote registered!</p></li> <li><p>Ok, let's finally vote on nodes 3 and 4.</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it addnode_node3_1 geth --exec <span class="token string">'istanbul.propose(&quot;0xb131288f355bc27090e542ae0be213c20350b767&quot;, true);'</span> attach /qdata/dd/geth.ipc
null
$ docker <span class="token builtin class-name">exec</span> -it addnode_node4_1 geth --exec <span class="token string">'istanbul.propose(&quot;0xb131288f355bc27090e542ae0be213c20350b767&quot;, true);'</span> attach /qdata/dd/geth.ipc
null
</code></pre></div></li> <li><p>Now we have a majority of votes, let's check the snapshot again:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'istanbul.getSnapshot();'</span> attach /qdata/dd/geth.ipc
<span class="token punctuation">{</span>
  epoch: <span class="token number">30000</span>,
  hash: <span class="token string">&quot;0xd4234184538297f71f5b7024a2e11f51f06b4f569ebd9e3644abd391b8c66101&quot;</span>,
  number: <span class="token number">656</span>,
  policy: <span class="token number">0</span>,
  tally: <span class="token punctuation">{</span><span class="token punctuation">}</span>,
  validators: <span class="token punctuation">[</span><span class="token string">&quot;0x6571d97f340c8495b661a823f2c2145ca47d63c2&quot;</span>, <span class="token string">&quot;0x8157d4437104e3b8df4451a85f7b2438ef6699ff&quot;</span>, <span class="token string">&quot;0xb131288f355bc27090e542ae0be213c20350b767&quot;</span>, <span class="token string">&quot;0xb912de287f9b047b4228436e94b5b78e3ee16171&quot;</span>, <span class="token string">&quot;0xd8dba507e85f116b1f7e231ca8525fc9008a6966&quot;</span>, <span class="token string">&quot;0xe36cbeb565b061217930767886474e3cde903ac5&quot;</span>, <span class="token string">&quot;0xf512a992f3fb749857d758ffda1330e590fa915e&quot;</span><span class="token punctuation">]</span>,
  votes: <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>We can see that the votes have now been wiped clean, ready for a new round. Additionally, the address we were adding,
<code>0xb131288f355bc27090e542ae0be213c20350b767</code> now exists within the <code>validators</code> list!
Lastly, the <code>unauthorized</code> messages that node 7 was giving before has stopped, as it now has the authority to mint
blocks.</p></li></ol> <h2 id="removing-a-node-from-the-validator-set"><a href="#removing-a-node-from-the-validator-set" aria-hidden="true" class="header-anchor">↳</a> Removing a node from the validator set</h2> <p>Removing a validator is very similar to adding a node, but this time we want to propose nodes with the value <code>false</code>,
to indicate we are deauthorising them. It does not matter whether the node is still online or not, as it doesn't
require any input from the node being removed.</p> <p>!!! warning
Be aware when removing nodes that cross the BFT boundary, e.g. going from 10 validators to 9, as this may impact the chains ability to progress if other nodes are offline</p> <p>Removing a new validator requires that a majority of existing validators propose the new node to be removed. This is
achieved by calling the <code>propose</code> RPC method with the value <code>false</code> and replacing the address to your required one:</p> <pre><code>```bash
$ geth attach /qdata/dd/geth.ipc
&gt; istanbul.propose(&quot;0xb131288f355bc27090e542ae0be213c20350b767&quot;, false);
null
```
</code></pre> <h3 id="example-2"><a href="#example-2" aria-hidden="true" class="header-anchor">↳</a> Example</h3> <p>You can find the resources required to run the examples in the
<a href="https://github.com/smilofoundation/Smilo-examples/tree/master/examples/ibft_validator_set_changes" target="_blank" rel="noopener noreferrer">Smilo-examples<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
repository.</p> <ol><li><p>The examples use <code>docker-compose</code> for the container definitions. If you are following along by copying the commands
described, then it is important to set the project name for Docker Compose, or to remember to change the prefix for
your directory. See <a href="https://docs.docker.com/compose/reference/envvars/#compose_project_name" target="_blank" rel="noopener noreferrer">Docker documentation<svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg></a>
for more details.</p> <p>To set the project name, run the following:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">COMPOSE_PROJECT_NAME</span><span class="token operator">=</span>addnode
</code></pre></div></li> <li><p>Bring up the network, which contains 7 nodes, of which 6 are validators.</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Set the environment variable for docker-compose</span>
$ <span class="token builtin class-name">export</span> <span class="token assign-left variable">COMPOSE_PROJECT_NAME</span><span class="token operator">=</span>addnode
<span class="token comment"># Start the 7 node network, of which 6 are validators</span>
$ docker-compose -f ibft-6-validators.yml up
</code></pre></div></li> <li><p>Now we need to propose node 6 as the node to remove.</p> <p>!!! note
We need a majority of existing validators to propose the new node before the changes will take effect.</p> <p>Lets start with node 1 and see what happens:</p> <div class="language-bash extra-class"><pre class="language-bash"><code><span class="token comment"># Propose node 7 from node 1</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'istanbul.propose(&quot;0x8157d4437104e3b8df4451a85f7b2438ef6699ff&quot;, false);'</span> attach /qdata/dd/geth.ipc
null
<span class="token comment"># Wait about 5 seconds, and then run:</span>
$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'istanbul.getSnapshot();'</span> attach /qdata/dd/geth.ipc
<span class="token punctuation">{</span>
  epoch: <span class="token number">30000</span>,
  hash: <span class="token string">&quot;0xba9f9b72cad90ae8aee39f352b45f21d5ed5535b4479743e3f39b231fd717792&quot;</span>,
  number: <span class="token number">140</span>,
  policy: <span class="token number">0</span>,
  tally: <span class="token punctuation">{</span>
    0x8157d4437104e3b8df4451a85f7b2438ef6699ff: <span class="token punctuation">{</span>
      authorize: false,
      votes: <span class="token number">1</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>,
  validators: <span class="token punctuation">[</span><span class="token string">&quot;0x6571d97f340c8495b661a823f2c2145ca47d63c2&quot;</span>, <span class="token string">&quot;0x8157d4437104e3b8df4451a85f7b2438ef6699ff&quot;</span>, <span class="token string">&quot;0xb912de287f9b047b4228436e94b5b78e3ee16171&quot;</span>, <span class="token string">&quot;0xd8dba507e85f116b1f7e231ca8525fc9008a6966&quot;</span>, <span class="token string">&quot;0xe36cbeb565b061217930767886474e3cde903ac5&quot;</span>, <span class="token string">&quot;0xf512a992f3fb749857d758ffda1330e590fa915e&quot;</span><span class="token punctuation">]</span>,
  votes: <span class="token punctuation">[</span><span class="token punctuation">{</span>
      address: <span class="token string">&quot;0x8157d4437104e3b8df4451a85f7b2438ef6699ff&quot;</span>,
      authorize: false,
      block: <span class="token number">136</span>,
      validator: <span class="token string">&quot;0xd8dba507e85f116b1f7e231ca8525fc9008a6966&quot;</span>
  <span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>Let's break this down.
Firstly, we proposed the address <code>0x8157d4437104e3b8df4451a85f7b2438ef6699ff</code> to be removed; that is what the
<code>false</code> parameter is for.</p> <p>Secondly, we fetched the current snapshot, which gives us an insight into the current running state of the voting.
We can see that the proposed address has 1 vote under the <code>tally</code> section, and that one vote is described under the
<code>votes</code> section. Here, the <code>authorize</code> section is set to <code>false</code>, which is inline with our proposal to <em>remove</em> the
validator.</p></li> <li><p>We need to get a majority, so let's run the proposal on 3 more nodes:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it addnode_node2_1 geth --exec <span class="token string">'istanbul.propose(&quot;0x8157d4437104e3b8df4451a85f7b2438ef6699ff&quot;, false);'</span> attach /qdata/dd/geth.ipc
null
$ docker <span class="token builtin class-name">exec</span> -it addnode_node3_1 geth --exec <span class="token string">'istanbul.propose(&quot;0x8157d4437104e3b8df4451a85f7b2438ef6699ff&quot;, false);'</span> attach /qdata/dd/geth.ipc
null
$ docker <span class="token builtin class-name">exec</span> -it addnode_node4_1 geth --exec <span class="token string">'istanbul.propose(&quot;0x8157d4437104e3b8df4451a85f7b2438ef6699ff&quot;, false);'</span> attach /qdata/dd/geth.ipc
null
</code></pre></div></li> <li><p>Let's check the snapshot now all the required votes are in:</p> <div class="language-bash extra-class"><pre class="language-bash"><code>$ docker <span class="token builtin class-name">exec</span> -it addnode_node1_1 geth --exec <span class="token string">'istanbul.getSnapshot();'</span> attach /qdata/dd/geth.ipc
<span class="token punctuation">{</span>
  epoch: <span class="token number">30000</span>,
  hash: <span class="token string">&quot;0x25815a32b086926875ea2c44686e4b20effabc731b2b121ebf0e0f395101eea5&quot;</span>,
  number: <span class="token number">470</span>,
  policy: <span class="token number">0</span>,
  tally: <span class="token punctuation">{</span><span class="token punctuation">}</span>,
  validators: <span class="token punctuation">[</span><span class="token string">&quot;0x6571d97f340c8495b661a823f2c2145ca47d63c2&quot;</span>, <span class="token string">&quot;0xb912de287f9b047b4228436e94b5b78e3ee16171&quot;</span>, <span class="token string">&quot;0xd8dba507e85f116b1f7e231ca8525fc9008a6966&quot;</span>, <span class="token string">&quot;0xe36cbeb565b061217930767886474e3cde903ac5&quot;</span>, <span class="token string">&quot;0xf512a992f3fb749857d758ffda1330e590fa915e&quot;</span><span class="token punctuation">]</span>,
  votes: <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre></div><p>The validator has been removed from the <code>validators</code> list, and we are left with the other 5 still present. You will
also see in the logs of node 6 a message like
<code>node6_1 | WARN [01-20|11:35:52.044] Block sealing failed err=unauthorized</code>. This is because it is still minting
blocks, but realises it does not have the authority to push them to any of the other nodes on the network (you will
also see this message for node 7, which was never authorised but still set up to mine).</p></li></ol> <h2 id="see-also"><a href="#see-also" aria-hidden="true" class="header-anchor">↳</a> See also</h2> <ul><li><a href="/How-To-Guides/adding_nodes">Adding a new node to the network</a></li></ul></div></main> <div class="sidebar" data-v-586e078c><nav class="nav-links"><ul class="nav-ul"><li class="nav-item"><a href="/" class="nav-link">Smilo</a></li><li class="nav-item"><a href="/beginners/" class="nav-link">Beginners</a></li><li class="nav-item"><a href="/use/" class="nav-link">Use</a></li><li class="nav-item"><a href="/learn/" class="nav-link">Learn</a></li><li class="nav-item"><a href="/developers/" class="nav-link">Developers</a></li> <div class="dropdown-wrapper nav-item"><a class="dropdown-title"><span class="title">Languages</span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/How-To-Guides/add_ibft_validator.html" class="nav-link router-link-exact-active router-link-active">English</a></li><li class="dropdown-item"><!----> <a href="/ko/" class="nav-link">Korean</a></li></ul></div></ul></nav>  <!----> </div> <footer class="footer" data-v-ca550d00 data-v-586e078c><div class="credits" data-v-ca550d00>
    Artwork by <a href="https://impermanence.co" target="_blank" data-v-ca550d00>Lili Feyerabend</a> feat. <a href="https://ilankatin.com" target="_blank" data-v-ca550d00>ilan katin</a>, <a href="https://linktr.ee/mattiacprodukt" target="_blank" data-v-ca550d00>Mattia Cuttini</a>, <a href="https://oficinastk.github.io" target="_blank" data-v-ca550d00>Oficinas TK</a>, <a href="https://xcopyart.com" target="_blank" data-v-ca550d00>XCOPY</a>.
  </div> <ul data-v-ca550d00><li data-v-ca550d00><a href="https://github.com/smilofoundation" target="_blank" data-v-ca550d00>GitHub</a></li> <li data-v-ca550d00><a href="https://twitter.com/smiloplatform" target="_blank" data-v-ca550d00>Twitter</a></li> <li data-v-ca550d00><a href="https://blog.smilo.foundation/" data-v-ca550d00>Blog</a></li> <li data-v-ca550d00><a href="/privacy-policy/" data-v-ca550d00>Privacy Policy</a></li> <li data-v-ca550d00><a href="/terms-of-use/" data-v-ca550d00>Terms of Use</a></li> <li data-v-ca550d00><a href="/cookie-policy/" data-v-ca550d00>Cookie Policy</a></li> <li data-v-ca550d00><a href="mailto:info@smilo.foundation" data-v-ca550d00>Contact</a></li></ul></footer> <a href="https://hackernoon.com/rethinking-the-identity-of-ethereumorg-l718w347l" target="_blank" data-v-586e078c><button class="announcement" data-v-586e078c>
      Read about the new artwork! <span class="accent" data-v-586e078c>→  More</span></button></a></div><div class="global-ui"></div></div>
    <script src="/assets/js/app.1c5a03b7.js" defer></script><script src="/assets/js/3.030594d3.js" defer></script><script src="/assets/js/35.af094489.js" defer></script>
  </body>
</html>
